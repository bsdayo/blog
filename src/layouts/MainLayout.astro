---
import '@/styles/global.css'
import { ClientRouter } from 'astro:transitions'

interface Props {
  title?: string
}

const baseTitle = "bsdayo's blog w/ Astro"
const title = Astro.props.title ? `${Astro.props.title} | ${baseTitle}` : baseTitle
---

<script is:inline>
  function getTheme() {
    if (typeof localStorage !== 'undefined') {
      let theme = localStorage.getItem('theme')
      if (theme) return theme
    }
    return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'
  }
  function setTheme(theme, target) {
    const doc = target ?? document
    doc.documentElement.classList[theme === 'dark' ? 'add' : 'remove']('dark')
    if (!target && typeof localStorage !== 'undefined') {
      localStorage.setItem('theme', theme)
    }
  }

  setTheme(getTheme())
  document.addEventListener('astro:before-swap', (event) => {
    setTheme(getTheme(), event.newDocument)
  })
</script>

<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <meta name="generator" content={Astro.generator} />
    <title>{title}</title>
    <ClientRouter />
  </head>
  <body class="m-0">
    <slot />
  </body>
</html>
